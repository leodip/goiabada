# Generated by goiabada-setup
# Run: docker compose up -d

services:

  mysql-server:
    image: mysql:latest
    restart: unless-stopped
    volumes:
      - mysql-data:/var/lib/mysql
    environment:
      MYSQL_ROOT_PASSWORD: WlxL8cSkXkANvoby
    healthcheck:
      test: ["CMD", "mysqladmin", "ping", "-uroot", "-pWlxL8cSkXkANvoby", "--protocol", "tcp"]
      interval: 1s
      timeout: 2s
      retries: 20
    networks:
      - goiabada-network

  goiabada-authserver:
    image: leodip/goiabada:authserver-latest
    restart: unless-stopped
    depends_on:
      mysql-server:
        condition: service_healthy
    ports:
      - 9090:9090
    networks:
      - goiabada-network
    healthcheck:
      test: ["CMD", "wget", "--spider", "http://localhost:9090/health"]
      interval: 10s
      timeout: 5s
      retries: 3
      start_period: 10s
    environment:
      - TZ=UTC
      - GOIABADA_ADMIN_EMAIL=admin@example.com
      - GOIABADA_ADMIN_PASSWORD=weak
      - GOIABADA_APPNAME=Goiabada
      - GOIABADA_AUTHSERVER_BASEURL=http://localhost:9090
      - GOIABADA_AUTHSERVER_INTERNALBASEURL=http://goiabada-authserver:9090
      - GOIABADA_AUTHSERVER_LISTEN_HOST_HTTP=0.0.0.0
      - GOIABADA_AUTHSERVER_LISTEN_PORT_HTTP=9090
      - GOIABADA_AUTHSERVER_LISTEN_HOST_HTTPS=
      - GOIABADA_AUTHSERVER_LISTEN_PORT_HTTPS=
      - GOIABADA_AUTHSERVER_CERTFILE=
      - GOIABADA_AUTHSERVER_KEYFILE=
      - GOIABADA_AUTHSERVER_TRUST_PROXY_HEADERS=false
      - GOIABADA_AUTHSERVER_SET_COOKIE_SECURE=false
      - GOIABADA_AUTHSERVER_LOG_HTTP_REQUESTS=true
      - GOIABADA_AUTHSERVER_LOG_SQL=false
      - GOIABADA_AUTHSERVER_AUDIT_LOGS_IN_CONSOLE=true
      - GOIABADA_AUTHSERVER_STATICDIR=
      - GOIABADA_AUTHSERVER_TEMPLATEDIR=
      - GOIABADA_AUTHSERVER_DEBUG_API_REQUESTS=false
      - GOIABADA_AUTHSERVER_SESSION_AUTHENTICATION_KEY=41050264a1669d324430b62b69a5d207a6c614c07d7990c0917f61cea9d7bd24cc70cc31e3e47e74b11ed6b0fef95224e783d37c247bdc74c835cebf50a71fc5
      - GOIABADA_AUTHSERVER_SESSION_ENCRYPTION_KEY=d239a989e77f5784cc7cdf77c13b9f3f8a4263173b9872eba79cd0312a48fec9
      - GOIABADA_ADMINCONSOLE_OAUTH_CLIENT_SECRET=w8iZDzGpEgJKGX6kumPeZuqcSKBKEyRTSBUjImnkbEQPeVnGec4Rmde85CCu
      - GOIABADA_DB_TYPE=mysql
      - GOIABADA_DB_USERNAME=root
      - GOIABADA_DB_PASSWORD=WlxL8cSkXkANvoby
      - GOIABADA_DB_HOST=mysql-server
      - GOIABADA_DB_PORT=3306
      - GOIABADA_DB_NAME=goiabada
      - GOIABADA_ADMINCONSOLE_BASEURL=http://localhost:9091

  goiabada-adminconsole:
    image: leodip/goiabada:adminconsole-latest
    restart: unless-stopped
    depends_on:
      goiabada-authserver:
        condition: service_healthy
    ports:
      - 9091:9091
    networks:
      - goiabada-network
    environment:
      - TZ=UTC
      - GOIABADA_ADMINCONSOLE_OAUTH_CLIENT_ID=admin-console-client
      - GOIABADA_ADMINCONSOLE_OAUTH_CLIENT_SECRET=w8iZDzGpEgJKGX6kumPeZuqcSKBKEyRTSBUjImnkbEQPeVnGec4Rmde85CCu
      - GOIABADA_ADMINCONSOLE_SESSION_AUTHENTICATION_KEY=535c0d5c95a584e3a349d43e6e7ca350ae405037b7d79624da16d3172dbaf95a70154a8eb548c54821ca2019dddeb362976afe8fd6b41b15f25a817051a3a266
      - GOIABADA_ADMINCONSOLE_SESSION_ENCRYPTION_KEY=0d3fe5ca91b3ceb462c4420cdef9ae11cf957c3a042c618feac4c3a96ce8f46b
      - GOIABADA_ADMINCONSOLE_BASEURL=http://localhost:9091
      - GOIABADA_ADMINCONSOLE_LISTEN_HOST_HTTP=0.0.0.0
      - GOIABADA_ADMINCONSOLE_LISTEN_PORT_HTTP=9091
      - GOIABADA_ADMINCONSOLE_LISTEN_HOST_HTTPS=
      - GOIABADA_ADMINCONSOLE_LISTEN_PORT_HTTPS=
      - GOIABADA_ADMINCONSOLE_CERTFILE=
      - GOIABADA_ADMINCONSOLE_KEYFILE=
      - GOIABADA_ADMINCONSOLE_TRUST_PROXY_HEADERS=false
      - GOIABADA_ADMINCONSOLE_SET_COOKIE_SECURE=false
      - GOIABADA_ADMINCONSOLE_LOG_HTTP_REQUESTS=true
      - GOIABADA_ADMINCONSOLE_STATICDIR=
      - GOIABADA_ADMINCONSOLE_TEMPLATEDIR=
      - GOIABADA_AUTHSERVER_BASEURL=http://localhost:9090
      - GOIABADA_AUTHSERVER_INTERNALBASEURL=http://goiabada-authserver:9090


volumes:
  mysql-data:

networks:
  goiabada-network:
